<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="assets_frontend" inherit_id="website.assets_frontend" name="Proposal Assets">
  <xpath expr="." position="inside">
    <script type="text/javascript" src="/specific_project_proposal/static/src/js/project_proposal.js"/>
  </xpath>
</template>

<template id="account" name="Account" inherit_id="website_portal.account">
  <xpath expr="//div[contains(@class,'o_my_documents')]" position="inside">
    <t t-call="specific_project_proposal.matches_overview" />
    <t t-call="specific_project_proposal.proposals_overview" />
  </xpath>
</template>

<template id="matches_overview" name="Proposals">
  <h3 class="page-header">Matches</h3>
  <t t-if="not matches">
    <p>No matches</p>
    <p>Please, verify you have set your expertises and industry on your profile.</p>
  </t>
  <t t-if="matches">
    <table class="table table-hover o_my_status_table">
      <thead>
      </thead>
      <t t-foreach="matches" t-as="proposal">
        <tr t-att-class="'hidden to_hide' if proposal_index &gt; 3 else ''">
          <td>
            <t t-if="proposal.is_new">
              &lt;b&gt;NEW!
            </t>
            <span t-field="proposal.name"/>
            <t t-if="proposal.is_new">
              &lt;/b&gt;
            </t>
          </td>
          <td>
            <span t-if="not proposal.website_published" class="label label-danger">not published</span>
          </td>
          <td>
            <span t-field="proposal.create_date" class="text-muted" t-field-options='{"format": "d MMMM y"}'/>
          </td>
          <td>
            <a t-attf-href="/proposals/detail/#{ slug(proposal) }" class="text-muted">
              Read More
            </a>
          </td>
        </tr>
      </t>
      <tr t-att-class="'hidden' if len(matches) &lt; 4 else ''">
        <td colspan="4"><a href="" class="o_my_show_more btn btn-xs btn-default"><span>Show more</span><span class="hidden">Show less</span></a></td>
      </tr>
    </table>
    <a class="btn btn-primary btn-show-proposal" t-attf-href="/market" title="Market">
        Market
    </a>
  </t>
</template>

<template id="proposals_overview" name="Proposals">
  <h3 class="page-header">Proposals</h3>
  <t t-if="not proposals">
    <p>You have currently registred no proposals on your account.</p>
  </t>
  <t t-if="proposals">
    <table class="table table-hover o_my_status_table">
      <thead>
      </thead>
      <t t-foreach="proposals" t-as="proposal">
        <tr t-att-class="'hidden to_hide' if proposal_index &gt; 3 else ''">
          <td>
            <b t-field="proposal.name"/>
          </td>
          <td>
            <span t-if="not proposal.website_published" class="label label-danger">not published</span>
          </td>
          <td>
            <span t-field="proposal.create_date" class="text-muted" t-field-options='{"format": "d MMMM y"}'/>
          </td>
          <td>
            <a t-attf-href="/my/proposals/edit/#{ slug(proposal) }" class="text-muted">
              Edit
            </a>
          </td>
        </tr>
      </t>
      <tr t-att-class="'hidden' if len(proposals) &lt; 4 else ''">
        <td colspan="4"><a href="" class="o_my_show_more btn btn-xs btn-default"><span>Show more</span><span class="hidden">Show less</span></a></td>
      </tr>
    </table>
  </t>
  <a class="btn btn-primary btn-show-proposal" t-attf-href="/my/proposals" title="Show all proposals">
    Show all proposals
  </a>
  <a class="btn btn-primary btn-add-proposal" t-attf-href="/my/proposals/add" title="Add a proposal">
      Add a proposal
  </a>
</template>

<template id="proposal_index" name="Proposals">
  <t t-call="website.layout">
    <div id="wrap">
      <div class="oe_structure">
        <section class="mb16">
          <div class="container">
            <div class="row">
              <div class="col-md-12 text-center mb16">
                <h2>Project proposals</h2>
              </div>
              <div class="col-md-12">
                <p>
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div class="container oe_website_proposals">
        <div class="row">
          <div class="hidden" id="proposals_grid_left">

          </div>
          <div class="col-md-12" id="proposals_grid">
            <div t-if="not proposals">
              <div class="text-center text-muted">
                <h4 class="css_editable_display">No project proposal found</h4>
                <h4 class="css_editable_hidden">There isn't project proposal published now, click <a t-attf-href="/page/website.contactus">here</a> to contact us</h4>
                <t groups="base.group_website_publisher">
                  <t  groups="base.group_hr_manager">
                    <p>Click on "Content" to define a new proposal offer or "Help" for more informations.</p>
                    <img src="/website/static/src/img/content_here.png"/>
                  </t>
                </t>
              </div>
            </div>
            <ul class="media-list" t-if="proposals">
              <li t-foreach="proposals" t-as="proposal" class="media">
                <div class="media-body proposal_item" t-att-data-publish="proposal.website_published and 'on' or 'off'">
                  <div class="text-muted">
                    <span t-field="proposal.create_date" t-field-options='{"format": "d MMMM y"}'/>
                  </div>
                  <h3 class="media-heading">
                    <span t-field="proposal.name"/>
                  </h3>
                  <t t-if="proposal.owner_id.id != uid">
                    <a class="hide_proposal fa fa-eye-slash no-decoration pull-right"
                      t-attf-data-href="/proposals/proposal/#{slug(proposal)}/hide"
                      title="Don't show again this project proposal"/>
                  </t>
                  <span t-if="not proposal.website_published" class="label label-danger">not published</span>
                  <p t-field="proposal.website_short_description"/>
                  <div>
                    <b>Industries:</b>
                    <t t-foreach="proposal.industry_ids" t-as="industry">
                      <span t-field="industry.name"/>
                    </t>
                    <a t-attf-href="/proposals/detail/#{ slug(proposal) }">
                      Read More <i class="fa fa-arrow-right"/>
                    </a>
                  </div>
                  <div class="pull-right">
                    Expertises:
                    <t t-foreach="proposal.expertise_ids" t-as="expertise">
                      <a t-attf-href="/proposals/expertise/#{slug(expertise)}">
                        <span t-attf-class="pull-right label #{expertise_tag and expertise_tag.name == expertise.name and 'label-primary' or 'label-default'}" t-field="expertise.name"
                          style="margin-right: 4px;"/>
                      </a>
                    </t>
                    <br />
                    Industries:
                    <t t-foreach="proposal.industry_ids" t-as="industry">
                      <a t-attf-href="/proposals/industry/#{slug(industry)}">
                        <span t-attf-class="pull-right label #{industry_tag and industry_tag.name == industry.name and 'label-primary' or 'label-default'}" t-field="industry.name"
                          style="margin-right: 4px;"/>
                      </a>
                    </t>
                  </div>
                </div>
              </li>

            </ul>
          </div>
        </div>
      </div>
    </div>
  </t>
</template>

<template id="layout">
  <t t-call="website.layout">
    <t t-set="additional_title">Proposal Detail</t>
    <div id="wrap" class="js_proposal o_website_proposal">
      <div class="oe_structure"/>

      <div class="container mt8">
        <div class="row">
          <div class="col-sm-7" id="proposal_menu">
            <ol class="breadcrumb mb0">
              <li><a href="/proposals">Proposals </a></li>
              <li class="active"><span t-field="proposal.name"></span></li>
            </ol>
          </div>
          <t t-if="proposal.owner_id.id == uid">
            <div class="col-sm-5">
              <t t-call="website.publish_management">
                <t t-set="object" t-value="proposal"/>
                <t t-set="publish_edit" t-value="True"/>
              </t>
            </div>
          </t>
        </div>
      </div>
      <t t-raw="0"/>
      <div class="oe_structure"/>
    </div>
  </t>
</template>

<template id="proposal_detail" name="Proposal Detail">
  <t t-call="specific_project_proposal.layout">

    <div class="oe_structure" style="clear:both;">
      <section class="content members-list opt_dark_bg">
      </section>
      <section class="content members-list">
        <div class="content-wrap">
          <div class="text-muted">
            <span t-field="proposal.create_date" t-field-options='{"widget": "date"}'/>
          </div>
          <address>
            <t t-set="partner" t-value="proposal.sudo().owner_id.partner_id"/>
            <t t-set="partner" t-value="partner.parent_id if partner.parent_id else partner"/>
            <b t-field="partner.name"/>
            <div t-field="partner.self" t-field-options='{
              "widget": "contact",
              "fields": ["address", "phone", "fax", "email"]
            }'/>
          </address>

          <h1 t-field="proposal.name"/>

          <p><b t-field="proposal.website_short_description"/></p>

          <p t-field="proposal.website_description"/>

          <div>
            <b>Country:</b>
            <span t-field="proposal.country_id"/>
          </div>
          <div>
            <b>Location:</b>
            <span t-field="proposal.location"/>
          </div>

          <div>
            <b>Duration:</b>
            <span t-field="proposal.start_date"/> - <span t-field="proposal.stop_date"/>
          </div>
          <div>
            <b>Industries:</b>
            <t t-foreach="proposal.industry_ids" t-as="industry">
              <span t-field="industry.name"/>
            </t>
          </div>
          <div>
            <b>Expertises:</b>
            <t t-foreach="proposal.expertise_ids" t-as="expertise">
              <span t-field="expertise.name"/>
            </t>
          </div>
        </div>
      </section>
      <section>
        <a class="btn btn-primary btn-show-proposal" t-attf-href="/market" title="Market">
            Return to list
        </a>
      </section>
    </div>
  </t>
</template>

<template id="proposal_edit" name="Proposal Edit">
  <t t-call="specific_project_proposal.layout">
    <div class="oe_structure" style="clear:both;">
      <form t-attf-action="/my/proposals/edit/#{ slug(proposal) }" method="post" enctype="multipart/form-data" t-attf-data-success_page="/my">
        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
        <div class="row o_website_portal_details">
          <h2>Proposal</h2>
          <div class="col-md-12">
            <div class="row">
              <div class="">
                <div t-if="error_message" class="alert alert-danger">
                  <t t-foreach="error_message" t-as="err">
                    <t t-esc="err" />
                    <br />
                  </t>
                </div>
              </div>
              <div t-attf-class="form-group row #{error.get('name') and 'has-error' or ''} ">
                <label class="form-control-label col-sm-2" for="name">Proposal name (*)
                </label>
                <input type="text" name="name" class="form-control"
                  t-att-value="name or proposal.name" />
              </div>
              <div t-attf-class="form-group row #{error.get('street2') and 'has-error' or ''} ">
                <label class="form-control-label col-sm-2" for="location">Location (*)
                </label>
                <input type="text" name="street2" class="form-control"
                  t-att-value="location or proposal.location" />
              </div>
              <div
                t-attf-class="form-group row #{error.get('country_id') and 'has-error' or ''} ">
                <label class="form-control-label col-sm-2" for="country_id">Country (*)
                </label>
                <div class="styled-select">
                  <select name="country_id" class="form-control">
                    <option value="">Country...</option>
                    <t t-foreach="countries or []" t-as="country">
                      <option t-att-value="country.id"
                        t-att-selected="country.id == proposal.country_id.id">
                        <t t-esc="country.name" />
                      </option>
                    </t>
                  </select>
                </div>
              </div>

              <div
                t-attf-class="form-group separate row #{error.get('website_short_description') and 'has-error' or ''} ">
                <label class="form-control-label label-optional col-sm-2"
                  for="website_short_description">Teaser text</label>
                <textarea placeholder="200 characters left" name="website_short_description" class="form-control"><t t-esc="proposal.website_short_description"/></textarea>
              </div>
              <div
                t-attf-class="form-group separate row #{error.get('website_description') and 'has-error' or ''} ">
                <label class="form-control-label label-optional col-sm-2"
                  for="website_description">Description</label>
                <textarea name="website_description" class="form-control"><t t-esc="proposal.website_description"/></textarea>
              </div>

              <div
                t-attf-class="form-group row #{error.get('industry_ids') and 'has-error' or ''} ">
                <label class="form-control-label col-sm-2" for="industry_ids">Industry
                </label>
                <input name="post_industries" placeholder="Industry" class="form-control js_select2_categories" t-attf-data-init-value="#{industries}" value="Industry" />
              </div>
              <div
                t-attf-class="form-group row #{error.get('expertise_ids') and 'has-error' or ''} ">
                <label class="form-control-label col-sm-2" for="expertise_ids">Expertise
                </label>
                <input name="post_expertises" placeholder="Expertise" class="form-control js_select2_expertises" t-attf-data-init-value="#{expertises}" value="Expertise" />
              </div>
            </div>
            <div class="button-wrap">
              <button type="submit" class="btn btn-default btn-primary mb32 ">Confirm</button>
              <a class="btn btn-default btn-primary mb32 ">Publish</a>
              <a class="btn btn-default btn-primary mb32 ">Delete</a>
            </div>
          </div>
        </div>
      </form>
    </div>

  </t>
</template>

</odoo>
