<?xml version="1.0" encoding="utf-8" ?>
<odoo>

		<template id="submenu" name="Fluxdock submenu">
			<!-- barely copied from website and fixed "active" class -->
		    <li t-if="not submenu.child_id" t-att-class="
		        'active' if submenu.url and submenu.url != '/' and submenu.url in request.httprequest.path else None">
		        <a t-att-href="(website.menu_id.child_id[0] == submenu) and '/' or submenu.url" t-ignore="true" t-att-target="'_blank' if submenu.new_window else None">
		            <span t-field="submenu.name"/>
		        </a>
		    </li>
		</template>


		<template id="personal_menu_content" name="Fluxdock personal menu content">
			<t t-set="user" t-value="request.env.user" />
			<li id="myhome">
				<a href="/my/home" role="menuitem"><i class="fa fa-user" t-translation="off" /> My home</a>
			</li>
			<li id="myprofile_edit">
				<a href="/my/account" role="menuitem"><i class="fa fa-pencil" t-translation="off" /> Edit my profile</a>
			</li>
			<li id="myprofile">
				<t t-set="profile_published" t-value="user.partner_id.website_published" />
				<a t-att-href="user.partner_id.website_url if profile_published else None" role="menuitem"
				   t-att-class="'disabled text-line-trough' if not profile_published else None">
				   <i class="fa fa-user" t-translation="off" /> My public profile
			    </a>
			</li>
			<li role="separator" class="divider"></li>
			<li id="add_reference">
				<a t-att-href="request.env['project.reference'].cms_add_url" role="menuitem"><i class="fa fa-plus" t-translation="off" /> Add reference</a>
			</li>
			<li id="add_proposal">
				<a t-att-href="request.env['project.proposal'].cms_add_url" role="menuitem"><i class="fa fa-plus" t-translation="off" /> Add proposal</a>
			</li>
			<li role="separator" class="divider"></li>
			<li id="reset_pwd">
				<a role="menuitem" t-attf-href="/web/reset_password?login=#{quote_plus(request.env.user.login)}"><i class="fa fa-lock" t-translation="off" /> Change password</a>
			</li>
			<li id="notifications-settings">
				<a role="menuitem" href="/my/settings/notifications"><i class="fa fa-envelope" t-translation="off" /> Notifications settings</a>
			</li>
			<li id="notifications">
				<a role="menuitem" href="/my/notifications"><i class="fa fa-envelope" t-translation="off" /> Notifications</a>
			</li>
			<li role="separator" class="divider"></li>
			<li id="logout">
				<a href="/web/session/logout?redirect=/" role="menuitem"><i class="fa fa-sign-out" t-translation="off" /> Logout</a>
			</li>
		</template>


		<template id="service_menu" name="Fluxdock service menu">
			<!-- Logged in -->
			<ul class="service-menu" t-ignore="true" t-if="request.session.uid">
				<li id="user-menu" t-att-class="'has_unread_notif' if request.env.user.has_unread_notif else None">
					<div class="dropdown">
						<a id="usermenu" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-user" />
							<span class="username" t-field="request.env.user.name" />
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" aria-labelledby="usermenu">
							<t t-call="fluxdock_theme.personal_menu_content" />
						</ul>
					</div>
				</li>
				<li>
					<t t-call="website.language_selector"/>
				</li>
			</ul>

			<!-- Anonymous -->
			<ul class="service-menu" t-ignore="true" t-if="not request.session.uid">
				<li>
					<a href="/web/login?redirect=/my/home">Login</a>
				</li>
				<li>
					<a href="/web/presignup">Sign Up</a>
				</li>
				<li>
					<t t-call="website.language_selector"/>
				</li>
			</ul>
		</template>

		<!-- Customize header -->
		<template id="custom_header" inherit_id="website.layout" name="Fluxdock custom header">

			<xpath expr="//div[@id='wrapwrap']/header" position="replace">
				<header id="my_header">
					<div class="fluxdock-topbar">

						<a href="/" class="navbar-brand">
							<!-- Needed for other modules to put their stuff in it -->
						</a>

						<a href="/" class="fluxdock-header-logo">
							<div class="fluxdock-logo"></div>
							<div class="fluxdock-title"></div>
						</a>
						<ul id="top_menu">
							<li></li>
							<!-- Needed for other modules to put their stuff in it -->
						</ul>

						<ul class="main-menu">
							<t t-foreach="website.menu_id.child_id" t-as="submenu">
								<t t-call="fluxdock_theme.submenu"/>
							</t>
						</ul>

						<t t-call="fluxdock_theme.service_menu"/>

						<ul style="display:none!important">
							<li id="o_logout">
								<!-- fake hook for other website modules that want this
										 to inject their stuff, but we don't want them to show anything here -->
							</li>
						</ul>

						<!-- Hamburger -->
						<div id="mobile-menu-trigger">
							<i class="fa fa-bars"></i>
						</div>
					</div>
				</header>
			</xpath>

		</template>

		<!-- Add mobile menu -->
		<template id="mobile-menu" inherit_id="website.layout" name="Fluxdock Mobile Menu">

			<xpath expr="//div[@id='wrapwrap']" position="before">
				<nav class="mobile-menu">
					<ul class="main-menu">
						<t t-foreach="website.menu_id.child_id" t-as="submenu">
							<t t-call="fluxdock_theme.submenu"/>
						</t>
					</ul>

					<!-- Logged in -->
					<ul class="service-menu" t-ignore="true" t-if="request.session.uid">
						<t t-call="fluxdock_theme.personal_menu_content" />
					</ul>

					<!-- Anonymous -->
					<ul class="service-menu" t-ignore="true" t-if="not request.session.uid">
						<li>
							<a href="/web/login?redirect=/my/home">Login</a>
						</li>
						<li>
							<a href="/web/presignup">Sign Up</a>
						</li>
					</ul>

					<t t-call="website.language_selector"/>

					<div class="social-media">
						<a class="facebook" href="https://www.facebook.com/fluxdock/" target="_blank"></a>
						<a class="twitter" href="https://twitter.com/fluxdock" target="_blank"></a>
						<a class="mail" href="mailto:info@fluxdock.io"></a>
					</div>

				</nav>
			</xpath>

		</template>

</odoo>
