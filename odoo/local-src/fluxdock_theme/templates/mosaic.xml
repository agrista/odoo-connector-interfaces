<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="mosaic" name="Fluxdock mosaic">

        <!--
        Create a mosaic of pictures using Masonry lib.

        USAGE 1 - javascript load (usable in snippets):

        <t t-call="fluxdock_theme.mosaic">
            <t t-set="data_model" t-value="'res.partner'" />
            <t t-set="data_limit" t-value="'4'" />
            <t t-set="data_order" t-value="'name asc'" />
            <t t-set="data_domain" t-value='"""[["create_uid","=",{}]]""".format(request.uid)' />
        </t>

        WARNING:

        The model must have a field `image_url` pointing to the correct image to use.

        USAGE 2 - pass mosaic items:

        <t t-call="fluxdock_theme.mosaic">
            <t t-set="mosaic_items" t-value="my_recordset" />
        </t>

        USAGE 3 - javascript load (usable in snippets):

        <t t-call="fluxdock_theme.mosaic">
            <t t-set="data_loadfrom" t-value="'/my/stuff/json'" />
            <t t-set="data_limit" t-value="'4'" />
        </t>

        -->

        <!-- if data-model is there we load items via JS -->
        <t t-set="data_model" t-value="not mosaic_items and data_model or None" />
        <t t-set="data_limit" t-value="data_limit or '8'" />
        <t t-set="data_order" t-value="data_order or 'create_date desc'" />
        <t t-set="data_domain" t-value="data_domain or '[]'" />
        <t t-set="data_loadfrom" t-value="data_loadfrom or None" />

        <div t-attf-class="mosaic grid mosaic_items_#{mosaic_items and len(mosaic_items) or 'none'}"
             t-att-data-model="data_model"
             t-att-data-limit="data_limit"
             t-att-data-order="data_order"
             t-att-data-domain="data_domain"
             t-att-data-loadfrom="data_loadfrom"
             data-fields='{"display_name":"title","website_url":"url","image_url":"src"}'>
          <t t-if="not mosaic_items">
              <!-- rendered via JS -->
              <div class="grid-item lazy"
                   data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/82/orange-tree.jpg">
                <h4>Lorem ipsum</h4>
              </div>
              <div class="grid-item lazy" data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/82/submerged.jpg">
                <h4>Lorem ipsum</h4>
              </div>
              <div class="grid-item lazy" data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/82/look-out.jpg">
                <h4>Lorem ipsum</h4>
              </div>
              <div class="grid-item lazy" data-src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/82/look-out.jpg">
                <h4>Lorem ipsum</h4>
              </div>
          </t>
          <t t-if="mosaic_items">
            <!-- rendered normally -->
            <t t-foreach="mosaic_items" t-as="item">
              <t t-call="fluxdock_theme.mosaic_item" />
            </t>
          </t>
        </div>
    </template>

    <template id="mosaic_item" name="Fluxdock mosaic item">
        <div class="grid-item lazy clickable"
             t-att-data-url="item.website_url"
             t-att-title="item.name"
             t-attf-data-src="#{item.image_url}">
          <h4><span t-esc="item.name" /></h4>
        </div>
    </template>

</odoo>
