<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- TODO: my home is going to be dropped -->

<template id="account" name="Fluxdock my/home add proposals" inherit_id="fluxdock_membership.my_home_content">
  <xpath expr="//div[@id='col-2']/t[@t-call][last()]" position="after">
    <t t-call="fluxdock_project.matches_overview" />
    <t t-call="fluxdock_project.proposals_overview" />
  </xpath>
</template>


<template id="matches_overview" name="Fluxdock my home matches">
    <div id="matches_overview" class="home_box">
        <h3 class="page-header">Matches</h3>
        <p>Matches are projects on the market, that correspond to your industry and expertise.</p>
        <t t-set="matches" t-value="request.env.user.proposal_match_ids" />
        <t t-if="not matches">
            <p>No matches</p>
            <p>Please, verify you have set your expertises and industry on your profile.</p>
        </t>
        <t t-if="matches">
            <table class="table table-hover no-border o_my_matches_table">
            <thead>
            </thead>
            <t t-foreach="matches" t-as="proposal">
                <tr t-att-class="'hidden to_hide' if proposal_index &gt; 3 else ''">
                <td>
                    <a t-att-href="proposal.website_url">
                    <t t-if="proposal.is_new">
                        &lt;b&gt;NEW!
                    </t>
                    <span t-field="proposal.name"/>
                    <t t-if="proposal.is_new">
                        &lt;/b&gt;
                    </t>
                    </a>
                </td>
                <td>
                    <span t-if="not proposal.website_published" class="label label-danger">not published</span>
                </td>
                <td>
                    <span t-field="proposal.create_date" class="text-muted" t-field-options='{"format": "d MMMM y"}'/>
                </td>
                <td>
                    <a t-att-href="proposal.website_url" class="text-muted">
                    Read More
                    </a>
                </td>
                </tr>
            </t>
            <tr t-att-class="'hidden' if len(matches) &lt; 4 else ''">
                <td colspan="4"><a href="" class="o_my_show_more btn btn-xs btn-default"><span>Show more</span><span class="hidden">Show less</span></a></td>
            </tr>
            </table>
            <div class="actions">
                <a class="btn btn-dark btn-show-proposal" t-att-href="request.env['project.proposal'].cms_search_url" title="Market">
                    Market
                </a>
            </div>
        </t>
    </div>
</template>

<template id="proposals_overview" name="Fluxdock my home proposals">
    <div id="proposals_overview" class="home_box">
        <h3 class="page-header">Proposals</h3>
        <p>Proposals are your entries on the market to look for collaboration partners in a certain industry or with a certain expertise.</p>
        <t t-set="proposals" t-value="request.env.user.proposal_ids" />
        <t t-if="not proposals">
            <p>You have currently registered no proposals on your account.</p>
        </t>
        <t t-if="proposals">
            <table class="table table-hover no-border o_my_proposal_table">
            <thead>
            </thead>
            <t t-foreach="proposals" t-as="proposal">
                <tr t-att-class="'hidden to_hide' if proposal_index &gt; 3 else ''">
                <td>
                    <a t-att-href="proposal.website_url"><b t-field="proposal.name"/></a>
                </td>
                <td>
                    <small t-if="not proposal.website_published" class="text-muted">not published</small>
                </td>
                <td>
                    <span t-field="proposal.create_date" class="text-muted" t-field-options='{"format": "d MMMM y"}'/>
                </td>
                <td>
                    <a t-att-href="proposal.cms_edit_url" class="text-muted">Edit</a>
                </td>
                </tr>
            </t>
            <tr t-att-class="'hidden' if len(proposals) &lt; 4 else ''">
                <td colspan="4"><a href="" class="o_my_show_more btn btn-xs btn-default"><span>Show more</span><span class="hidden">Show less</span></a></td>
            </tr>
            </table>
        </t>
        <div class="actions">
            <a t-attf-class="btn btn-dark btn-show-proposal #{not partner.website_published and 'disabled'}"
               t-att-href="partner.website_published and (request.env['project.proposal'].cms_search_url + '?only_my=on')" title="Show all proposals">
                Show all proposals
            </a>
            <a t-attf-class="btn btn-dark btn-add-proposal #{not partner.website_published and 'disabled'}"
               t-att-href="partner.website_published and request.env['project.proposal'].cms_add_url" title="Add a proposal">
               Add a proposal
            </a>
        </div>
    </div>
</template>

</odoo>
