<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- override personal account view -->
    <template id="account" name="Fluxdock my home view" inherit_id="website_portal.account">

        <xpath expr="//div[contains(@class,'o_my_documents')]" position="inside">
            <t t-call="specific_membership.my_home_content" />
        </xpath>
        <!-- reset classes -->
        <xpath expr="//div[contains(@class,'container mb64')]" position="attributes">
            <attribute name="class">mb64</attribute>
        </xpath>
        <xpath expr="//div[contains(@class,'o_my_documents')]" position="attributes">
            <attribute name="class">o_my_documents my_home</attribute>
        </xpath>
        <xpath expr="//div[contains(@class, 'o_my_sidebar')]" position="attributes">
          <attribute name="class">hide col-md-3 col-md-offset-1 o_my_sidebar</attribute>
        </xpath>
    </template>

    <template id="my_home_content" name="Fluxdock my home content">
        <div class="container my_home_content">
            <div class="row">
                <div id="col-1" class="col col-md-6">
                    <t t-call="specific_membership.partner_table" />
                </div>
                <div id="col-2" class="col col-md-6">
                    <t t-call="specific_membership.website_membership_status" />
                </div>
            </div>
        </div>
    </template>


    <!-- Add header in my account -->
    <template id="fluxdock_my_account_header" name="Fluxdock my home header" inherit_id="website_portal.account">
        <xpath expr="//div[contains(@id,'wrap')]" position="before">
            <section class="content members-list opt_dark_bg">
              <div class="content-wrap">
                <div class="content-icon">
                  <img src="/specific_membership/static/src/img/member-white.png"></img>
                </div>
                <h2>My Account</h2>
                <p>Manage your company profile, your membership and your project proposals on the market. Matching project proposals from the market will also be shown here.</p>
              </div>
            </section>
            <t t-call="specific_membership.profile_progress_bar" />
        </xpath>
    </template>

    <!-- Partner profile table -->
    <template id="partner_table" name="Fluxdock my/home partner table">
        <!-- Temporary hiding / change. Waiting for final design -->
        <!--<div id="partner_table" class="col-md-12">-->
        <div id="partner_table" class="home_box">
            <h3 class="page-header">Member profile</h3>
            <t t-if="partner">
                <table class="table table-condensed member-profile-table no-border">
                    <tr>
                        <td>
                            <div class="media">
                                <img itemtype="image" class="img img-responsive" t-att-src="website.image_url(partner, 'image', None if product_image_big else '128x128')"/>
                            </div>
                        </td>
                        <td>
                          <b><t t-esc="partner.name" /></b><br/>
                          <b><t t-esc="partner.street2" /></b><br/>
                          <b><t t-esc="partner.zip"/> <t t-esc="partner.city"/></b><br/>
                          <b><t t-esc="partner.country_id.name"/></b>
                        </td>
                    </tr>
                    <tr>
                        <td>Phone:</td>
                        <td><t t-esc="partner.phone" /></td>
                    </tr>
                    <tr>
                        <td>Email:</td>
                        <td><t t-esc="partner.email" /></td>
                    </tr>
                    <tr>
                        <td>Website:</td>
                        <td><t t-esc="partner.website"/></td>
                    </tr>
                    <tr>
                        <td>Facebook:</td>
                        <td><t t-esc="partner.facebook"/></td>
                    </tr>
                    <tr>
                        <td>Twitter:</td>
                        <td><t t-esc="partner.twitter"/></td>
                    </tr>
                    <tr>
                        <td>Skype:</td>
                        <td><t t-esc="partner.skype"/></td>
                    </tr>
                    <tr>
                        <td>Claim:</td>
                        <td><t t-esc="partner.website_short_description"/></td>
                    </tr>
                    <tr>
                        <td>Industry:</td>
                        <td>
                            <t t-foreach="partner.category_id" t-as="one_tag">
                              <t t-esc="one_tag.name + ('' if one_tag_last else ', ')" />
                            </t>
                        </td>
                    </tr>
                    <tr>
                        <td>Expertise:</td>
                        <td>
                            <t t-foreach="partner.expertise_ids" t-as="one_tag">
                              <t t-esc="one_tag.name + ('' if one_tag_last else ', ')" />
                            </t>
                        </td>
                    </tr>
                </table>
            </t>
            <div class="actions">
              <a t-attf-class="btn btn-dark #{not partner.website_published and 'disabled'}"
                 t-att-href="partner.website_published and partner.website_url" title="View profile">
                  View profile
              </a>
              <a class="btn btn-dark" href="/my/account" title="Edit profile">
                  Edit profile
              </a>
            </div>
        </div>
    </template>

    <template id="membership_status_free_claim" name="Fluxdock my home status free claim">
        You are a Fluxdock member. You can create your public profile on Fluxdock and register company references.
        As Fluxdock associate members you have full access on the market.
        For <t t-esc="product_price" t-esc-options='{"widget": "monetary", "display_currency": "res_company.currency_id"}' /> per year you can make proposals and read all proposals on the market.
        Become a Fluxdock associate member now.
    </template>

    <template id="membership_status_associate_claim" name="Fluxdock my home status associate claim">
        You are a Fluxdock associate member. You have full access on the market, you can add proposals and read all proposals on the market.
    </template>

    <template id="website_membership_status" name="Fluxdock membership status homebox">
        <div id="website_membership_status" class="home_box">
            <h3 class="page-header">Membership status</h3>

            <p>
                <b class="state">Status:</b> <span class="ml8" t-esc="partner.flux_membership_display" />
                <t t-if="partner.flux_membership == 'asso'">
                    <span class="sep" t-translation="off"> - </span>
                    <b class="expiration">Expiration: </b> <span t-field="partner.membership_stop" t-field-options='{"format": "dd / MM / yyyy"}'/>
                </t>
            </p>
            <t t-if="partner.flux_membership == 'asso'">
                <div class="claim">
                    <t t-call="specific_membership.membership_status_associate_claim" />
                </div>
            </t>
            <t t-if="partner.flux_membership == 'free'">
                <div class="claim">
                    <t t-call="specific_membership.membership_status_free_claim">
                        <t t-set="product_price" t-value="membership_info['product_price']" />
                    </t>
                </div>
                <div class="actions">
                    <a t-attf-class="btn btn-dark mb32 center-block #{not partner.website_published and 'disabled'}"
                       t-att-href="partner.website_published and '/my/membership'">
                        Membership Upgrade
                    </a>
                </div>
            </t>
        </div>
    </template>

</odoo>
